# -*- fill-column: 76; -*-
#+Title: BTF (Bpf Type Format) notes
#+OPTIONS: ^:nil

The BPF Type Format (BTF) is a really cool feature that allows us to
describe data types used in e.g. BPF-maps (both key and value).

The [[https://www.kernel.org/doc/html/latest/bpf/btf.html#bpf-type-format-btf][kernel BTF documentation]] is all about encoding details, and not about
how to use BTF.

This is my notes for trying to understand how to use BTF
*from within the kernel*.

* Motivation

Specifically I want to figure out, if we can use BTF to allow for
dynamically extending and changing e.g. the map value type, and still have
the kernel validate the contents.

** Use-case: devmap and cpumap

The practical use-case is extending =devmap= and =cpumap= with a BPF-prog
that is run when an =xdp_frame= is redirected to a entry in the map.

David Ahern have [[https://lore.kernel.org/netdev/20200522010526.14649-1-dsahern@kernel.org/][posted RFC]] on extending =devmap=.
